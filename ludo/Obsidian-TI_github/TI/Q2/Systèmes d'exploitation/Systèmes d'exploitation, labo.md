- [[#Gestion des utilisateurs et des groupes|Gestion des utilisateurs et des groupes]]
	- [[#Gestion des utilisateurs et des groupes#Etape 1 : Utilisateurs et groupes :|Etape 1 : Utilisateurs et groupes :]]
	- [[#Gestion des utilisateurs et des groupes#Etape 2 : Authentification|Etape 2 : Authentification]]
	- [[#Gestion des utilisateurs et des groupes#Etape 3 : Droits d'accès|Etape 3 : Droits d'accès]]
	- [[#Gestion des utilisateurs et des groupes#Etape 4 : Fichiers journaux.|Etape 4 : Fichiers journaux.]]
- [[#Liens et raccourci système|Liens et raccourci système]]
	- [[#Liens et raccourci système#Etape 1 : Création et utilisation des liens|Etape 1 : Création et utilisation des liens]]
# Gestion des utilisateurs et des groupes  
Avant d’aborder le laboratoire, que pouvez-vous dire sur les éléments suivants :  
1) Citer différents types de comptes utilisateurs sous Unix,  
	-   Compte utilisateur normal: utilisé pour se connecter au système et accéder aux ressources autorisées par les permissions.
	-   Compte superutilisateur (root): compte avec tous les privilèges et permissions sur le système.
	-   Compte de service: compte utilisé par les services système pour fonctionner.
	-   Compte invité: compte temporaire et limité pour les utilisateurs non enregistrés ou non authentifiés.
2) Dans quel fichier sont renseignés les groupes secondaires d'un compte utilisateur ?  
	/etc/group.
3) Comment ajouter le compte utilisateur « Paul » sur le système sachant que le groupe  
	« formateur » existant doit être son groupe principal ?  
		- useradd -g formateur paul  (bonne réponse)
		- useradd paul ; groupadd paul formateur  
		- useradd -G formatuer paul  
		- useradd paul ; usermod- G formateur paul  
4) Que fait la commande find / -user 502 ?  
	- Elle recherche le mot de passe de l'utilisateur ayant l'UID égal à 502,  
	- Elle retourne le nom de l'utilisateur ayant l'UID égal à 502,  
	- Elle affiche le nom des fichiers ayant les droits positionnés à 502 en notation octale,  
	- Elle affiche le nom de tous les fichiers appartenant à l'utilisateur ayant l'UID 502 dans l'arborescence du système,  (bonne réponse)
5) Quelle est la fonction de PAM ?  
	PAM (Pluggable Authentication Modules) est un système modulaire qui fournit un cadre pour l'authentification des utilisateurs sur un système Unix ou Linux. PAM permet aux applications d'utiliser des méthodes d'authentification flexibles et configurables, telles que les mots de passe, les certificats, les jetons de sécurité, etc.
6) Quel droit signifie qu'un programme doit être lancé avec l'identifiant du propriétaire du fichier  
	- X  
	- SUID  (bonne réponse)
	- SGID  
	- bit « sticky »
	Le droit qui signifie qu'un programme doit être lancé avec l'identifiant du propriétaire du fichier est le droit SUID (Set User ID). Lorsqu'un fichier a le bit SUID défini, il est exécuté avec les permissions du propriétaire du fichier, plutôt que celles de l'utilisateur qui l'a lancé.
## Etape 1 : Utilisateurs et groupes :  
1) Se connecter en tant que root sur une console texte,  
	su root
2) Lister les comptes utilisateurs et les groupes existants sur le système.  
Indice : afficher le contenu des fichiers /etc/passwd et /etc/group  
```bash
cat /etc/passwd
cat /etc/group
```
3) Quels sont l'UID et le GID du compte « root » ?  
	UID = 0 et GID = 0
4) Quelles sont les valeurs minimales des UID et GID utilisés par défaut lors de la création de  
nouveaux comptes utilisateurs ou groupes ? Faire de sorte que l'UID minimal soit 700 et que  
le GID minimal soit 800.  
Indice : Le fichier de configuration des commandes de gestion des comptes utilisateurs  
et des groupes est /etc/login.defs  
	Les valeurs minimales des UID et GID utilisées par défaut lors de la création de nouveaux comptes utilisateurs ou groupes sont 1000. Pour modifier cela, il faut éditer le fichier /etc/login.defs et changer les valeurs des paramètres UID_MIN et GID_MIN en 700 et 800 respectivement.
5) Créer les groupes « grp1 », « grp2 » et « grp3 ». Le GID du groupe « grp3 » doit être  
823. Indice : Les commandes nécessaires sont groupadd et groupmod  
```
groupadd grp1
groupadd grp2
groupadd -g 823 grp3
```
6) Créer les comptes utilisateurs « user1 », « user2 » et « user3 » (avec leur répertoire  
personnel) ayant respectivement les groupes « grp1 », « grp2 » et « grp3 » comme groupe  
principal. Le compte « user2 » doit aussi être membre du groupe « grp1 » et « grp3 ». Le  
pseudonyme « tux1 » de l'utilisateur « user1 » doit être renseigné dans la configuration.  
Indice : Les commandes nécessaires ici sont useradd et usermod. Il est possible de  
renseigner des informations complémentaires pour un utilisateur dans le champ GECOS  
du fichier de configuration /etc/group  
```python
useradd -g grp1 -m -c "tux1" user1
useradd -g grp2 -m user2
useradd -g grp3 -m user3
```
	Pour ajouter un utilisateur à plusieurs groupes, on peut utiliser la commande `usermod`:
	`usermod -aG grp1,grp3 user2`
	Le champ GECOS peut être renseigné lors de la création de l'utilisateur avec l'option "-c" ou modifié ultérieurement avec la commande `chfn`.
7) Noter les UID et GID des comptes utilisateurs et groupes créés précédemment.  
Indice : Consulter pour cela les fichiers /etc/passwd et /etc/group  
```bash
cat /etc/passwd
cat /etc/group
```
8) Supprimer le groupe « grp3 ». Cela est-il possible ? Pourquoi ?  
Indice : Utiliser la commande groupdel
	1.  Il n'est pas possible de supprimer le groupe "grp3" tant que l'utilisateur "user3" en est encore membre. Pour supprimer le groupe, il faut d'abord enlever tous les utilisateurs qui en sont membres, ou utiliser l'option "-f" avec la commande `groupdel` pour forcer la suppression (mais cela peut entraîner des problèmes si d'autres fichiers du système référencent encore ce groupe).
	2.  Les commandes pour supprimer le compte utilisateur "user3" et le groupe "grp3" sont :
	`userdel user3 groupdel grp3`
	L'option "-r" peut être ajoutée à la commande `userdel` pour supprimer également le répertoire personnel de l'utilisateur. 10) Après la suppression du compte utilisateur "user3", le répertoire /home/user3 appartient toujours à l'utilisateur "user3" (UID 1003) mais le groupe associé est désormais "grp2" (GID 1002), car le groupe "grp3" a été supprimé.
9) Supprimer le compte utilisateur « user3 » sans supprimer son répertoire personnel,  
puis supprimer le groupe « grp3 ».  
Indice : Utiliser les commandes userdel et groupdel  
```
sudo userdel user3
sudo groupdel grp3
```
	La première commande supprime le compte utilisateur "user3", tandis que la seconde supprime le groupe "grp3".
	1.  Après avoir supprimé le compte utilisateur "user3" et le groupe "grp3", le répertoire "/home/user3" appartient maintenant à l'utilisateur et au groupe ayant les mêmes UID et GID que ceux relevés en question 7. Si ces UID et GID appartiennent toujours à un autre utilisateur ou groupe, alors le répertoire appartient à cet utilisateur ou groupe.
	2.  Pour retrouver et supprimer tous les fichiers orphelins du système qui appartenaient au compte utilisateur "user3" ou au groupe "grp3", vous pouvez utiliser la commande find avec les critères -user et -group. Voici la commande à exécuter dans un terminal :
	`sudo find / -user user3 -o -group grp3 -delete`
	Cette commande recherche tous les fichiers appartenant à l'utilisateur "user3" ou au groupe "grp3" à partir de la racine ("/") du système de fichiers, puis les supprime.
10) A qui appartient maintenant le répertoire « /home/user3 » ? Pourquoi ?  
Indice : Vérifier s'il y a une relation entre les UID et les GID indiqués pour le répertoire  
et ceux relevés en question 7  
	Le répertoire "/home/user3" appartient maintenant à l'utilisateur ayant l'UID 1002 et au groupe ayant le GID 1002. Cela est dû au fait que lorsqu'un utilisateur est supprimé, son répertoire personnel n'est pas supprimé par défaut. Ainsi, le répertoire "/home/user3" est resté avec ses attributs de propriétaire d'origine, qui étaient l'UID et le GID de "user3".
	
	Cependant, si le groupe "grp3" avait été supprimé avant de supprimer l'utilisateur "user3", alors le répertoire "/home/user3" aurait été affecté par la suppression du groupe. En effet, si l'utilisateur n'appartient plus à un groupe existant, il perd les droits sur les fichiers et les répertoires appartenant à ce groupe, y compris son répertoire personnel.
11) Comment retrouver et supprimer tous les fichiers orphelins du système qui appartenaient  
au compte utilisateur « user3 » ou au groupe « grp3 » ?  
Indice : Utiliser la commande find avec les critères -user et –group  
	Pour retrouver tous les fichiers orphelins (c'est-à-dire les fichiers qui ne sont plus associés à un utilisateur ou à un groupe existant) appartenant à l'utilisateur "user3" ou au groupe "grp3", vous pouvez utiliser la commande find avec les options -nouser, -user et -nogroup, -group respectivement.
	La commande pour trouver tous les fichiers orphelins appartenant à l'utilisateur "user3" serait :
	`find / -nouser -user user3 -type f`
	Et la commande pour trouver tous les fichiers orphelins appartenant au groupe "grp3" serait :
	`find / -nogroup -group grp3 -type f`
	Une fois que vous avez vérifié que ces commandes renvoient bien la liste des fichiers orphelins correspondants, vous pouvez les supprimer en ajoutant l'option -delete à la fin de la commande find, par exemple :
	`find / -nouser -user user3 -type f -delete find / -nogroup -group grp3 -type f -delete`
	Assurez-vous d'être sûr de supprimer ces fichiers car cette action est irréversible.
12) Que ce serait-il passé avec le dossier « /home/user3 » si nous avions créé un utilisateur  
« user4 » ayant le même UID que « user3 » après suppression de celui-ci (cfr. étape 9 et 10) ?
	Si un utilisateur « user4 » ayant le même UID que « user3 » est créé après la suppression de « user3 », alors le répertoire personnel de « user3 » /home/user3 appartiendrait à l'utilisateur « user4 ». Cela se produit car les systèmes Unix et Linux utilisent les identificateurs d'utilisateur (UID) pour identifier les utilisateurs plutôt que les noms d'utilisateur. Donc, si un nouvel utilisateur est créé avec le même UID que l'utilisateur précédent, il obtient les mêmes autorisations et propriétaires de fichier que l'utilisateur précédent. Cependant, toutes les données et fichiers associés à « user3 » auraient été supprimés, car la suppression de l'utilisateur a entraîné la suppression de tous ses fichiers et données associés.

## Etape 2 : Authentification  
1) Se connecter en tant que « user1 » sur une console virtuelle libre. Cela s'est-il bien passé ?  
Indice : Il est possible de passer d'une console virtuelle à une autre en appuyant  
simultanément sur les touches (CTRL) et (ALT) suivies d'une des six premières touches  
de fonction (F1) à (F6)  
	su user1
2) Affecter un mot de passe aux comptes utilisateurs « user1 » et « user2 ». En dehors  
de l'administrateur, qui peut modifier le mot de passe d'un utilisateur ?  
Indice : utiliser la commande « passwd »  
	Vous pouvez utiliser la commande « passwd » pour affecter un mot de passe à un utilisateur. Seul l'administrateur peut modifier le mot de passe d'un utilisateur.
3) Se connecter à nouveau en tant que « user1 » sur une console virtuelle libre avec le mot  
de passe affecté précédemment. Cela s'est-il bien passé ?  
Indice : Il faut utiliser la même casse de caractères (majuscules / minuscules) que lors  
de l'affectation des mots de passe.  
	Si vous avez entré correctement le mot de passe affecté à l'utilisateur « user1 », vous devriez pouvoir vous connecter sans problème en tant que cet utilisateur.
4) Sans se déconnecter, changer d'identité en « user2 » sans modifier les  
variables d'environnement.  
Indice : Utiliser la commande « su » et vérifier les variables via « env »  
	Pour changer d'identité en « user2 » sans modifier les variables d'environnement, utilisez la commande « su user2 ».
5) Recommencer l'étape précédente en chargeant cette fois l'environnement complet du compte  
utilisateur « user2 »  
Indice : Utiliser la commande « su » avec l'option – ou -l ou –login et vérifier les variables  
	Pour charger l'environnement complet du compte utilisateur « user2 », utilisez la commande « su - user2 ».
6) Se déconnecter de toutes les consoles en « user1 » et « user2 » puis bloquer le compte  
« user1 » sans perdre le mot de passe. Vérifier ensuite qu'il n'est plus possible de se connecter  
en tant que « user1 »  
Indice : Utiliser la commande passwd  
	Pour bloquer le compte utilisateur « user1 » sans perdre le mot de passe, utilisez la commande « passwd -l user1 ». Pour vérifier qu'il n'est plus possible de se connecter en tant que « user1 », essayez de vous connecter avec ce compte utilisateur.
7) Déverrouiller le compte « user1 ». Vérifier ensuite qu'il est de nouveau possible de se  
connecter en tant que « user1 »  
	Pour déverrouiller le compte utilisateur « user1 », utilisez la commande « passwd -u user1 ». Vérifiez ensuite qu'il est de nouveau possible de se connecter en tant que « user1 ».
8) Comment un utilisateur peut-il obtenir les droits de l’administrateur ou devenir administrateur ? 
	Un utilisateur peut obtenir temporairement les droits de l'administrateur en utilisant la commande "sudo" avant une commande qui nécessite des privilèges d'administration. L'utilisateur doit entrer son propre mot de passe pour effectuer cette élévation de privilèges. Cependant, pour devenir administrateur à part entière, un utilisateur doit avoir accès aux identifiants d'administrateur ou être ajouté au groupe "sudoers" avec des droits d'administration appropriés.
9) Quelle différence il y a-t-il entre la commande « su » et « sudo » ?  
Remarque : Le système Linux possède un module appelé « PAM » permettant la gestion avancée  
de l’authentification, comme la définition de la politique de mots de passe, le nombre de  
tentative maximum autorisée, etc. La gestion de ce module étant plus complexe et nécessitant  
plus de connaissances, celui-ci sera abordé dans le cours « OpenSource avancé » de 2ème année
	La commande « su » permet de changer d'identité pour se connecter en tant qu'un autre utilisateur, tandis que la commande « sudo » permet d'exécuter une commande avec les privilèges de l'utilisateur root. La commande « sudo » offre plus de sécurité car elle permet de donner des privilèges d'administration à un utilisateur sans lui donner l'accès complet au compte root.

## Etape 3 : Droits d'accès  
1) En tant que « user1 », créer le répertoire rep1 dans « /tmp » puis créer le fichier vide « fic1 »  
dans ce répertoire. Quels sont les droits associés à ces nouveaux fichiers ?  
Indice : utiliser les commandes « mkdir », « touch » et « ls »  
```bash
mkdir /tmp/rep1
touch /tmp/rep1/fic1
ls -l /tmp/rep1
```
	Les droits associés à ces nouveaux fichiers seront les droits par défaut définis par la valeur d'umask de l'utilisateur qui exécute les commandes.
2) Modifier la valeur de « umask » de « user1 » à 007.  
Indice : utiliser la commande « umask »  
```bash
umask 007
```
3) Créer un nouveau répertoire « rep2 » contenant un fichier vide « fic2 » dans « /tmp » et  
regarder les droits associés à ces nouveaux fichiers. Cela a-t-il changé les droits des fichiers  
déjà existants ? Qu’en est-il du nouveau fichier créé ?  
```bash
mkdir /tmp/rep2
touch /tmp/rep2/fic2
ls -l /tmp/rep2
```
	Les droits associés à ces nouveaux fichiers prendront en compte la nouvelle valeur d'umask de l'utilisateur qui exécute les commandes. Cela n'affectera pas les droits des fichiers déjà existants.
4) Changer les droits du fichier « fic2 » afin que personne ne puisse les modifier.  
Indice : utiliser la commande « chmod »  
```bash
chmod 444 /tmp/rep2/fic2
```
	Cela va modifier les droits du fichier fic2 en lecture seule pour tous les utilisateurs.
5) Se connecter en tant que « user2 » sur une console texte libre,  
```
su - user2
```
6) Essayer de supprimer le fichier « /tmp/rep2/fic2 ». Est-ce possible? Pourquoi ?  
	En essayant de supprimer le fichier /tmp/rep2/fic2 en tant que user2, on obtiendra un message d'erreur indiquant que l'on n'a pas la permission de supprimer ce fichier. Cela est dû au fait que les droits du fichier ont été modifiés pour le rendre en lecture seule pour tous les utilisateurs.
7) Expliquez brièvement, via des exemples l’utilisation des commandes « chmod » et « umask »
	La commande chmod permet de modifier les droits d'accès d'un fichier ou d'un répertoire, en précisant les permissions pour le propriétaire, le groupe et les autres utilisateurs. Par exemple, la commande chmod 755 fichier permet de donner au propriétaire tous les droits, au groupe et aux autres utilisateurs seulement le droit de lecture et d'exécution. La commande umask permet de définir les permissions par défaut pour les nouveaux fichiers et répertoires créés par l'utilisateur. Par exemple, si la valeur d'umask est 022, cela signifie que les droits par défaut pour les nouveaux fichiers seront rw-r--r-- et pour les nouveaux répertoires rwxr-xr-x.

## Etape 4 : Fichiers journaux.  
1) Aller dans le répertoire « /var/log »  
	cd /var/log
2) Lister avec un affichage détaillé les fichiers du répertoire du plus ancien au plus récent.  
	"ls -ltr" pour lister les fichiers par ordre chronologique croissant
3) Consulter les fichiers « messages », « syslog » et « auth.log ».  
Indice : Ces fichiers pouvant être volumineux, utiliser les commandes « less » et « more  
» pour les visualiser.  
4) Visualiser uniquement les dernières lignes du fichier « /var/log/auth.log » avec un affichage  
mis à jour en temps réel.  
Indice : Utiliser la commande « tail » avec l'option adéquate.  
	"tail -f /var/log/auth.log" pour visualiser les dernières lignes du fichier auth.log avec un affichage mis à jour en temps réel
5) Se connecter en tant que « user2 » sur une autre console texte et retourner voir l'affichage de  
la commande précédente en cours.

# Liens et raccourci système  
Avant d’aborder le laboratoire, que pouvez-vous dire sur les éléments suivants :  
1) Qu’est-ce qu’un « inode » ?  
	Un "inode" est une structure de données utilisée par les systèmes de fichiers Unix et Linux pour stocker des informations sur un fichier ou un répertoire, telles que les autorisations d'accès, les propriétaires, les dates de modification et la localisation physique sur le disque dur.
2) Qu’est que la table des « inodes » ?  
	La table des "inodes" est une structure de données utilisée par les systèmes de fichiers Unix et Linux pour stocker des informations sur tous les inodes disponibles sur le système de fichiers.
3) La taille de cette table est-elle fixe ou dynamique ?  
	La taille de cette table peut être fixe ou dynamique en fonction de la façon dont le système de fichiers est créé et configuré.
4) Comment et en fonction de quoi définit-on la taille de cette table ?  
	La taille de cette table est définie lors de la création du système de fichiers en fonction de la taille de la partition ou du disque dur sur lequel le système de fichiers est créé.
5) Comment afficher l’inode d’un fichier ?  
	Pour afficher l'inode d'un fichier, on peut utiliser la commande "ls -i" qui affichera le numéro d'inode en premier dans la liste des fichiers.
6) Comment créer et libérer un « inode » ?  
	Les inodes sont créés et libérés automatiquement par le système de fichiers lorsque des fichiers ou des répertoires sont créés ou supprimés.
7) Est-il possible que 2 fichiers différents possèdent le même « inode » ?  
	Il est possible que deux fichiers différents possèdent le même inode si l'un des fichiers a été créé en utilisant la même allocation d'espace disque qu'un fichier précédemment supprimé.
8) Qu’appelle-t-on lien physique et lien symbolique ? Quelle est la différence ?  
	Un lien physique est un lien direct vers un fichier, qui pointe vers l'emplacement physique de ce fichier sur le disque dur. Un lien symbolique est un type de lien qui pointe vers un nom de fichier ou un chemin d'accès plutôt que vers l'emplacement physique du fichier.
9) A quoi sert un lien symbolique ? Et un lien physique ?  
	Un lien symbolique est souvent utilisé pour créer des alias ou des raccourcis vers des fichiers ou des répertoires. Un lien physique est souvent utilisé pour créer des copies de sauvegarde ou pour partager un fichier entre plusieurs utilisateurs.
10) Faites le parallèle entre la commande « cp » et la commande « ln ».  
	La commande "cp" est utilisée pour copier un fichier ou un répertoire. La commande "ln" est utilisée pour créer un lien symbolique ou physique vers un fichier ou un répertoire existant. Avec "cp", une copie physique du fichier est créée tandis qu'avec "ln", un lien est créé vers le fichier ou le répertoire existant.
## Etape 1 : Création et utilisation des liens  
1) Créez un lien symbolique dans votre répertoire personnel pointant sur « /var/log  
». Indice : utiliser la commande « ln » avec l’option adéquate  
	La commande "ln -s" est utilisée pour créer ce lien. Une fois créé, un "ls -l" montre le lien symbolique avec la flèche " -> " pointant vers le répertoire cible.
2) Créez un lien physique dans votre répertoire personnel pointant sur un fichier « mp3  
». Indice : créer le fichier « mp3 » et utiliser la commande « ln »  
	la commande "ln" sans l'option "-s" est utilisée. Une fois créé, un "ls -l" montre que le lien physique pointe vers le fichier d'origine.
3) Créez un lien symbolique dans votre répertoire personnel pointant sur un fichier texte.  
Indice : créer un fichier texte et utiliser la commande « ln » avec l’option adéquate  
	Pour créer un lien symbolique vers un fichier, la commande "ln -s" est utilisée. Une fois créé, un "ls -l" montre le lien symbolique avec la flèche " -> " pointant vers le fichier cible.
4) Créez un lien physique dans votre répertoire personnel pointant sur le dossier  
/tmp/votreNom Indice : créer le dossier dans « /tmp » et utiliser la commande « ln »
	Pour créer un lien physique vers un répertoire, la commande "ln" sans l'option "-s" est utilisée. Une fois créé, un "ls -l" montre que le lien physique pointe vers le répertoire d'origine.
Décrivez et argumentez (notamment via certains « printscreen ») l’utilité et l’utilisa tion des  
liens physiques et symboliques.
	En résumé, les liens symboliques sont des raccourcis vers des fichiers ou des répertoires qui peuvent être créés dans n'importe quel répertoire. Ils sont créés en utilisant la commande "ln -s" et peuvent être utilisés pour créer des chemins d'accès plus courts et plus lisibles. Les liens physiques sont des copies exactes d'un fichier existant et sont créés en utilisant la commande "ln" sans l'option "-s". Ils partagent le même inode que le fichier original et toute modification apportée à l'un affectera également les autres. Les liens symboliques, en revanche, ont leur propre inode et peuvent pointer vers un fichier ou un répertoire dans un autre système de fichiers.
